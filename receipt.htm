<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Receipt — Epic Shutter Hub</title>

<!-- jsPDF & html2canvas CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
:root{
  --brand:#111827;
  --accent:#2563eb;
  --muted:#6b7280;
  --border:#e5e7eb;
  --paper:#ffffff;
  --bg:#f8fafc;
  --radius:14px;
  --font: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
}

*{box-sizing:border-box}

body{
  font-family:var(--font);
  background:var(--bg);
  padding:32px 12px;
  color:#111827;
  -webkit-font-smoothing:antialiased;
}

/* MAIN CONTAINER */
.receipt-shell{
  max-width:880px;
  margin:auto;
  background:var(--paper);
  border-radius:var(--radius);
  border:1px solid var(--border);
  overflow:hidden;
}

/* HEADER */
.receipt-header{
  padding: 10px 10px;
  border-bottom:1px solid var(--border);
  display:flex; 
  align-items: center;
  justify-content:space-between;
  gap:16px;
  flex-wrap: wrap;
}

.brand-left{
  display:flex;
  gap:1px;
  justify-content: center;
  flex-direction: column;
  align-items:center;
  text-align: center;
}

.brand-left img{
  height:  clamp(80px, 10vw, 100px);
  width:  clamp(80px, 10vw, 100px);
  border-radius: 100%;
  background:#fff;
  border:1px solid var(--border);
}

.brand-left h1{
  font-size:1.15rem;
  margin:0;
  font-weight:700;
}

.small{
  font-size:.85rem;
  color:var(--muted);
  line-height:1.4;
}

.receipt-meta{
  text-align:center;
  font-size:.9rem;
}

.receipt-id{
  display:inline-block;
  margin-left:6px;
  padding:4px 10px;
  border-radius:999px;
  background:#f1f5f9;
  font-weight:600;
}

/* BODY */
.receipt-body{
  display:grid;
  grid-template-columns:1fr 300px;
  gap:24px;
  padding:28px;
}

@media(max-width:800px){
  .receipt-body{grid-template-columns:1fr}
}

/* ITEMS TABLE */
.items{
  border:1px solid var(--border);
  border-radius:12px;
  overflow:hidden;
}

.items table{
  width:100%;
  border-collapse:collapse;
}

.items thead th{
  background:#f8fafc;
  padding:12px;
  font-size:.8rem;
  text-transform:uppercase;
  letter-spacing:.04em;
  color:var(--muted);
  border-bottom:1px solid var(--border);
}

.items tbody td{
  padding:14px 12px;
  border-bottom:1px solid var(--border);
  font-size:.95rem;
}

.items tbody tr:last-child td{
  border-bottom:none;
}

.item-name{
  font-weight:600;
}

.mono{
  font-variant-numeric:tabular-nums;
  font-family:ui-monospace, SFMono-Regular, Menlo, monospace;
}

/* SUMMARY */
.summary{
  border:1px solid var(--border);
  padding:5px;
  gap: 10px;
}

.summary h4{
  margin:10px 0 14px 0;
  font-size:.95rem;
  font-weight:700;
}

.summary-row{
  display:flex;
  justify-content:space-between;
  padding:8px 0;
  font-size:.9rem;
  color:#374151;
}

.summary-row.total{
  margin-top:12px;
  padding-top:14px;
  border-top:1px solid var(--border);
  font-weight:700;
  font-size:1rem;
}

/* FOOTER */
.footer{
  padding:20px 28px;
  border-top:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
  gap:12px;
  background:#fafafa;
}

/* BUTTONS */
.btns{display:flex;gap:10px}

button.btn{
  padding:10px 16px;
  border-radius:10px;
  font-size:.9rem;
  font-weight:600;
  cursor:pointer;
  border:1px solid var(--border);
  background:white;
}

.btn.primary{
  background:var(--accent);
  border-color:var(--accent);
  color:white;
}

.btn.primary:hover{opacity:.92}
.btn.ghost:hover{background:#f1f5f9}
li{
        list-style: none;
}
/* PRINT / PDF OPTIMIZATION */
@media screen{
        
.items thead th{
  background:#f8fafc;
  padding:1px;
  font-size:.8rem;
  text-transform:uppercase;
  letter-spacing:.04em;
  color:var(--muted);
  border-bottom:1px solid var(--border);
}
}
@media print{
  body{background:white;padding:0}
  .btns{display:none}
  .receipt-shell{border:none}
}
</style>

</head>
<body>

<div class="receipt-shell" id="receiptRoot">

  <header class="receipt-header">
        
    <div class="receipt-meta">
        <h2 style="text-align: center;">INVOICE</h2>
      <div>Receipt #: <span class="receipt-id" id="receiptNo">ES-000123</span></div>
      <div id="receiptDate">Date: 2025-12-11 12:00</div>
      <div id="paidVia" class="small">Paid via: Flutterwave</div>
    </div>
    <div class="brand-left">
      <img id="brandLogo" src="https://epicshutterhub.vercel.app/logoimg.webp" alt="logo">
      <div>
        <h1 id="brandName">Epic Shutter Hub</h1>
       <li class="small"><div class="" id="brandAddr">Kampala, Uganda </div>
</li>  <li class="small"><div class="" id="brandAddr">epicshutterhub1@gmail.com</div> </li>
</li>  <li class="small"><div class="" id="brandAddr"> +256 0753 4792 196</div> </li>
 
      </div>
    </div>

</header>

    <aside class="summary">
            <div style="display: flex; gap: 10px;">
<div class="content" style="display: grid; flex: 50%;">
      
                  <div style="margin-top:14px" class="small">Bill to</div>
                  <div style="font-weight:700;margin-top:6px" id="custName">John Doe</div>
                  <div class="small" id="custPhone">+256 700 000000 john@example.com</div>  
</div><div class="content" style="display: grid; flex: 50%;">
        
                  <div style="margin-top:14px" class="small">From </div>
                  <div style="font-weight:700;margin-top:6px" id="">Epic Shutter Hub</div>
                  <li class="small"><div class="" id="brandAddr"> +256 0753 4792 196</div> </li>
                  <li class="small"><div class="" id="brandAddr"><a style="text-decoration: none;"  href="mailto:epicshutterhub1@gmail.com" id="brandAddr">epicshutterhub1@gmail.com</a></div> </li>
                  
</div>
            </div>
      <h4>Order Summary</h4>
      <div class="summary-row"><div class="small">Subtotal</div><div id="subVal" class="mono">UGX 0</div></div>
      <div class="summary-row"><div class="small">Shipping</div><div id="shipVal" class="mono">UGX 0</div></div>
      <div class="summary-row"><div class="small">Tax</div><div id="taxVal" class="mono">UGX 0</div></div>
      <div class="summary-row total"><div>Total</div><div id="totalVal">UGX 0</div></div>

      <hr style="margin:14px 0;border:none;border-top:1px solid #f1f5f9">

      <div class="small">Order Notes</div>
      <div id="orderNotes" style="margin-top:8px;color:var(--muted)">Delivered within 2–3 business days.</div>
    </aside>

  <section class="receipt-body">
    <div class="items">
      <table>
        <thead>
          <tr><th>Item</th><th>Qty</th><th>Price</th><th style="text-align:right">Total</th></tr>
        </thead>
        <tbody id="itemsTbody">
          <!-- JS will inject rows -->
        </tbody>
      </table>
    </div>
  </section>

  <div class="footer">
    <div class="small">Thank you for your purchase! Contact support at hello@epicshutterhub.com</div>
    <div class="btns">
      <button class="btn ghost" id="printBtn">Print</button>
      <button class="btn primary" id="downloadPdfBtn">Download PDF</button>
    </div>
  </div>
</div>

<script>
  // ---------- Sample order data (replace with real data from your app) ----------
  const sampleOrder = {
    receiptNo: "ES-" + Date.now().toString().slice(-6),
    dateISO: new Date().toISOString(),
    paidVia: "Flutterwave",
    customer: {
      name: "Akala Ian",
      phone: "+256763471092",
      email: "iancovixakala2023@gmail.com"
    },
    items: [
      { name: "Canon EOS R6", unitPrice: 4200000, qty: 1 },
      { name: "50mm Lens", unitPrice: 950000, qty: 1 },
      { name: "Camera Bag", unitPrice: 75000, qty: 2 },
    ],
    shipping: 15000,
    taxPercent: 0 // set tax percent (e.g., 18)
  };

  // ---------- Utilities ----------
  const currencyFormat = (n) => {
    // UGX doesn't use decimals usually
    return "UGX " + Number(n).toLocaleString("en-UG");
  };

  function populateReceipt(order) {
    document.getElementById("receiptNo").textContent = order.receiptNo;
    document.getElementById("receiptDate").textContent = "Date: " + new Date(order.dateISO).toLocaleString();
    document.getElementById("paidVia").textContent = "Paid via: " + order.paidVia;

    // Customer
    document.getElementById("custName").textContent = order.customer.name;
    document.getElementById("custPhone").textContent = order.customer.phone + " • " + order.customer.email;

    // Items
    const tbody = document.getElementById("itemsTbody");
    tbody.innerHTML = "";
    let subtotal = 0;
    order.items.forEach((it, i) => {
      const row = document.createElement("tr");
      const lineTotal = it.unitPrice * it.qty;
      subtotal += lineTotal;
      row.innerHTML = `
        <td class="item-name">${it.name}</td>
        <td>${it.qty}</td>
        <td class="mono">${currencyFormat(it.unitPrice)}</td>
        <td class="mono" style="text-align:right">${currencyFormat(lineTotal)}</td>
      `;
      tbody.appendChild(row);
    });

    const tax = Math.round((order.taxPercent/100) * subtotal);
    const total = subtotal + (order.shipping || 0) + tax;

    document.getElementById("subVal").textContent = currencyFormat(subtotal);
    document.getElementById("shipVal").textContent = currencyFormat(order.shipping || 0);
    document.getElementById("taxVal").textContent = currencyFormat(tax);
    document.getElementById("totalVal").textContent = currencyFormat(total);

    document.getElementById("orderNotes").textContent = order.notes || "Thank you for supporting local business.";
  }

  populateReceipt(sampleOrder);

  // ---------- Print ----------
  document.getElementById("printBtn").addEventListener("click", () => {
    window.print();
  });

  // ---------- Download PDF (html2canvas + jsPDF) ----------
  document.getElementById("downloadPdfBtn").addEventListener("click", async () => {
    const root = document.getElementById("receiptRoot");
    // Use html2canvas to rasterize the element at a high scale
    const canvas = await html2canvas(root, { scale: 2, useCORS: true, backgroundColor: null ,
        windowWidth: root.scrollWidth,
  windowHeight: root.scrollHeight
    });
    const imgData = canvas.toDataURL("image/png");

    // jsPDF
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF({
      orientation: "portrait",
      unit: "pt",
      format: "a4"
    });

    const pageWidth = pdf.internal.pageSize.getWidth();
    const pageHeight = pdf.internal.pageSize.getHeight();

    // Calculate image size to fit width while preserving aspect ratio
    const imgProps = pdf.getImageProperties(imgData);
    const imgWidth = pageWidth; // margins
    const imgHeight = (imgProps.height * imgWidth) / imgProps.width;
    let heightLeft = imgHeight;
    let position = 0;

    pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
heightLeft -= pageHeight;
    const fname = `receipt-${document.getElementById("receiptNo").textContent}.pdf`;
    pdf.save(fname);
  });
  //for adding extra pages if the height exceeds one page
  while (heightLeft > 0) {
  position = heightLeft - imgHeight;
  pdf.addPage();
  pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
  heightLeft -= pageHeight;
}

  // ---------- Helper: call this when order completes ----------
  // Example: call generateReceiptPDF(order) after payment verification
  async function generateReceiptPDF(order) {
    populateReceipt(order);
    // small delay to render
    await new Promise(r => setTimeout(r, 300));
    document.getElementById("downloadPdfBtn").click();
  }

  // Example usage: generate PDF after successful payment
  // generateReceiptPDF(sampleOrder);
</script>
</body>
</html>
