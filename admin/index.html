<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<!-- Font Awesome CDN for icons -->
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
  integrity="sha512-papQ3a5tF4xDfqVj9K5O/wGk4+oLzrF2FqQ6x5k1lG3D4Cn6gWksuOlfJ+kYvsPAyD2yJq+v4G3B+N9j3W6rKQ=="
  crossorigin="anonymous"
  referrerpolicy="no-referrer"
/>
<link href="https://fonts.googleapis.com/css2?family=Special+Gothic+Expanded+One&display=swap" rel="stylesheet">
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
  integrity="sha512-papQ3a5tF4xDfqVj9K5O/wGk4+oLzrF2FqQ6x5k1lG3D4Cn6gWksuOlfJ+kYvsPAyD2yJq+v4G3B+N9j3W6rKQ=="
  crossorigin="anonymous"
  referrerpolicy="no-referrer"
/>

<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
  integrity="sha512-Qq5o1lH+5e7WkV/2aLsh+V5J4oGx7y5wWGL7Xf+Q6z3a0e3NqM1E3Z5s9T0QhzA4ZP+z5+1cB6B6Lk8z4C9TQ=="
  crossorigin="anonymous"
  referrerpolicy="no-referrer"
/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
  /* --- ROOT VARIABLES --- */
  :root {
    --primary-dark: #000;
    --accent: #a02424;
    --light-gray: #f5f5f8;
    --border-gray: #ddd;
    --text-dark: #1a1a1a;
    --shadow-sm: 0 3px 8px rgba(0,0,0,0.08);
    --shadow-md: 0 4px 16px rgba(0,0,0,0.1);
  }
  * { margin:0; padding:0; box-sizing:border-box; font-family: 'Poppins', sans-serif;}
  body { background: var(--light-gray); color: var(--text-dark); }

  /* --- HEADER --- */
  .header {
    display:flex;
    justify-content: space-between;
    align-items: center;
    padding:15px 30px;
    background:#fff;
    box-shadow: var(--shadow-md);
    position: sticky;
    top:0;
    z-index: 1000;
  }
  .logo img{
    border-radius: 100%;
    height: clamp(70px, calc(2vw+10px),80px);
    width: clamp(70px, calc(2vw+10px),80px);
}
.logo h1{
      font-size: clamp(.7rem,calc( 2vw + .3rem), 1.8rem);
    font-family: "Special Gothic Expanded One", sans-serif;
}
.logo {
    font-size: 1.5rem;
    display: flex;
    gap: 1.4rem;
    justify-content: space-evenly;
    font-weight: bold;
    align-items: center;
    color: var(--primary-dark);
}
.admin-sign {
    display: flex;
    align-items: center;
    gap: 15px;
}
/* Full screen background */
#access {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,3.9); /* semi-transparent overlay */
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

/* Form container */
#accessForm {
  background: #fff;
  padding: 30px 40px;
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.2);
  width: 100%;
  max-width: 400px;
  display: flex;
  flex-direction: column;
  gap: 15px;
}

/* Form elements */
#accessForm h2 {
  text-align: center;
  margin-bottom: 10px;
  color: #222;
}

#accessForm input {
  padding: 12px;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 1rem;
}

#accessForm button {
  padding: 12px;
  background: #a02424;
  color: #fff;
  font-weight: bold;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.2s;
}

#accessForm button:hover {
  background: #222;
}

  #signOutBtn { cursor:pointer; background:none; border:none; font-size:1.1rem; }

  /* --- CONTAINER --- */
  .container { display:flex; gap:20px; padding:20px; min-height: calc(100vh - 70px); }

  /* --- NAV PANEL --- */
  .nav-panel { flex:0 0 220px; background:#fff; border-radius:12px; box-shadow:var(--shadow-sm); padding:20px; display:flex; flex-direction:column; gap:15px;}
  .nav-panel ul { list-style:none; display:flex; flex-direction:column; gap:12px; }
  .nav-panel li { padding:10px 15px; border-radius:8px; cursor:pointer; transition:0.2s; }
  .nav-panel li:hover { background:var(--accent); color:#fff; }

  /* --- MAIN PANEL --- */
  .main { flex:1; background:#fff; border-radius:12px; padding:25px; box-shadow:var(--shadow-md); display:flex; flex-direction:column; gap:30px;}

  /* --- FORM --- */
  .admin-box { width:100%; max-width:500px; background:var(--light-gray); padding:20px; border-radius:12px; box-shadow:var(--shadow-sm); margin:auto; }
  input, textarea, select { width:100%; padding:12px; margin:8px 0; border-radius:8px; border:1px solid var(--border-gray); font-size:0.95rem; }
  button { width:100%; padding:12px; background:var(--primary-dark); color:#fff; border:none; border-radius:8px; cursor:pointer; font-weight:600; transition:0.2s; }
  button:hover { background:var(--accent); }

  /* --- IMAGE PREVIEW --- */
  .preview-container { display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }
  .preview-container img { width:80px; height:80px; object-fit:cover; border-radius:8px; border:1px solid #ccc; }

  /* --- TABLE --- */
  table { width:100%; border-collapse: collapse; border-radius:12px; overflow:hidden; box-shadow:var(--shadow-sm); }
  th, td { padding:14px; border-bottom:1px solid var(--border-gray); text-align:left; font-size:0.95rem; }
  th { background: var(--primary-dark); color:#fff; }
  img { width:50px; height:50px; object-fit:cover; border-radius:6px; }

  /* --- RESPONSIVE --- */
  @media (max-width:992px){ .container{ flex-direction:column;} .nav-panel{flex-direction:row; overflow-x:auto; height:auto;} .nav-panel ul{flex-direction:row; gap:10px;} .main{width:100%;} }
</style>
</head>
<body>

<!-- HEADER -->
<div class="header">
                       <div style="padding: 0;" class="logo">
                <img style="border-radius: 50%;" width="80px" height="80px" src="/logoimg.webp" loading="lazy" alt="logo image">
                <h1>Epic Shutter Hub</h1>
            </div>
            <div class="admin-sign">
              <p>Logout</p><i onclick="window.location.href='https://epicshutterhub.vercel.app/'" style="background: black; transition: background .3 ease; padding: 10px; color: white;cursor: pointer;"class="fas fa-sign-out-alt"></i>
            </div>
</div>
<div id="access">
  <form id="accessForm">
    <h2>Admin Panel</h2>
    <input type="text" placeholder="Username" id="username">
    <input type="password" placeholder="Password" id="password">
    <button type="submit">Login</button>
  </form>
</div>

<!-- CONTAINER -->
<div class="container">
  <!-- NAV PANEL -->
  <div class="nav-panel">
    <ul>
      <li onclick="showAddProduct()">Add Product</li>
      <li onclick="editProduct()">Edit Product</li>
      <li onclick="showProductList()">Product List</li>
  
    </ul>
  </div>

  <!-- MAIN PANEL -->
  <div class="main">
    <div id="productListBox" style="display:none;">
  <h2>Product List</h2>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Images</th>
        <th>Price</th>
        <th>Category</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="productTable"></tbody>
  </table>
</div>

<!-- EDIT PRODUCT MODAL -->
<div id="editModal" style="display:none;">
  <div class="admin-box" >
    <h2>Edit Product</h2>
    <input type="text" id="editName" placeholder="Product Name">
    <input type="number" id="editPrice" placeholder="Price">
    <textarea id="editDesc" placeholder="Description"></textarea>
    <select id="editCategory">
      <option disabled selected>Select Category</option>
      <option>Cameras</option>
      <option>Lenses</option>
      <option>Lighting</option>
      <option>Accessories</option>
    </select>
    <input type="file" accept="images/*" id="editImgFiles" multiple>
    <div id="editPreview" class="preview-container"></div>
    <button onclick="updateProduct()">Save Changes</button>
    <button style="background:#aaa;margin-top:10px;" onclick="closeEditModal()">Cancel</button>
  </div>
</div>
    <!-- ADD PRODUCT FORM -->
    <div class="admin-box" id="addProductBox">
      <h2>Add Product</h2>
      <input type="text" id="pname" placeholder="Product Name">
      <input type="number" id="price" placeholder="Price">
      <textarea id="desc" placeholder="Description"></textarea>
      <select id="category">
        <option disabled selected>Select Category</option>
        <option>Cameras</option>
        <option>Lenses</option>
        <option>Lighting</option>
        <option>Accessories</option>
      </select>
      <input type="file" accept="images/*" id="imgFiles" multiple>
      <div id="preview" class="preview-container"></div>
      <button onclick="saveProduct()">Save Product</button>
      <p id="status"></p>
    </div>

    <!-- PRODUCT TABLE -->
    <div id="productListBox" style="display:none;">
      <h2>Product List</h2>
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Images</th>
            <th>Price</th>
            <th>Category</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="productTable"></tbody>
      </table>
    </div>
  </div>
</div><script type="module">
  // IMPORTS
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  import { getDatabase } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
  import { getStorage } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";
  import { getAuth } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  // CONFIG
  const firebaseConfig = {
    apiKey: "AIzaSyB235hCAouus9JhFLpWJ64DiXVvNaGYNm0",
    authDomain: "epicshutterhub-ee0d9.firebaseapp.com",
    projectId: "epicshutterhub-ee0d9",
    storageBucket: "epicshutterhub-ee0d9.firebasestorage.app",
    messagingSenderId: "49117682378",
    appId: "1:49117682378:web:7ebc026bb467eac04ab233",
    measurementId: "G-WV4SM92954"
  };

  // INIT
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);
  const auth = getAuth(app);

  // TEST
  console.log("Firebase Connected:", app);


// --- ADMIN NAV FUNCTIONS ---
function showAddProduct(){
  document.getElementById("addProductBox").style.display = "block";
  document.getElementById("productListBox").style.display = "none";
  document.getElementById("editModal").style.display = "none";
}

function showProductList(){
  document.getElementById("addProductBox").style.display = "none";
  document.getElementById("productListBox").style.display = "block";
  document.getElementById("editModal").style.display = "none";
}

function editProduct(){  
  document.getElementById("editModal").style.display = "flex";
  document.getElementById("addProductBox").style.display = "none";
  document.getElementById("productListBox").style.display = "none";
}
function closeEditModal(params) {
  
    document.getElementById("editModal").style.display = "none";  
  document.getElementById("addProductBox").style.display = "block";
  document.getElementById("productListBox").style.display = "none";
}

  // --- IMAGE PREVIEW ---
  const imgInput = document.getElementById("imgFiles");
  const preview = document.getElementById("preview");
  imgInput.addEventListener("change", ()=>{
    preview.innerHTML = "";
    Array.from(imgInput.files).forEach(file=>{
      if(!file.type.startsWith("image/")) return;
      const reader = new FileReader();
      reader.onload = (e)=>{
        const img = document.createElement("img");
        img.src = e.target.result;
        preview.appendChild(img);
      }
      reader.readAsDataURL(file);
    });
  });

  // --- SAVE PRODUCT ---
  async function saveProduct(){
    const name = document.getElementById("pname").value;
    const price = document.getElementById("price").value;
    const desc = document.getElementById("desc").value;
    const cat = document.getElementById("category").value;
    const files = document.getElementById("imgFiles").files;
    const status = document.getElementById("status");

    if(!name || !price || !desc || !cat || files.length===0){
      status.innerText = "Fill all fields.";
      return;
    }

    status.innerText = "Uploading Product...";
    let imageUrls = [];
    for(let file of files){
      const ref = storage.ref("products/"+Date.now()+"-"+file.name);
      await ref.put(file);
      const url = await ref.getDownloadURL();
      imageUrls.push(url);
    }

    await db.collection("products").add({
      name, price, description: desc, category: cat, images: imageUrls, createdAt: Date.now()
    });

    status.innerText = "Product Saved ✔";
    imgInput.value = "";
    preview.innerHTML = "";
    document.getElementById("pname").value="";
    document.getElementById("price").value="";
    document.getElementById("desc").value="";
    document.getElementById("category").selectedIndex=0;
  }

  // --- DISPLAY PRODUCTS ---
  const productTable = document.getElementById("productTable");
  db.collection("products").orderBy("createdAt","desc").onSnapshot(snapshot=>{
    productTable.innerHTML = "";
    snapshot.forEach(doc=>{
      const p = doc.data();
      let imgHTML = "";
      p.images.forEach(url => imgHTML+=`<img src="${url}">`);
      productTable.innerHTML+=`
        <tr>
          <td>${p.name}</td>
          <td>${imgHTML}</td>
          <td>$${p.price}</td>
          <td>${p.category}</td>
          <td>
            <button onclick="deleteProduct('${doc.id}', ${JSON.stringify(p.images).replace(/"/g,'&quot;')})">Delete</button>
          </td>
        </tr>
      `;
    });
  });

  // --- DELETE PRODUCT ---
  async function deleteProduct(id, images){
    if(!confirm("Delete this product?")) return;
    for(let url of images){
      try{
        const path = decodeURIComponent(url.split("/o/")[1].split("?")[0]);
        await storage.ref(path).delete();
      }catch(e){console.log(e);}
    }
    await db.collection("products").doc(id).delete();
    alert("Product deleted");
  }

  // --- SIGN OUT ---
  const signOutBtn = document.getElementById("signOutBtn");
  signOutBtn.addEventListener("click", ()=>{
    auth.signOut().then(()=>{ alert("Signed out"); window.location.href="login.html"; })
    .catch(err=>console.error(err));
  });


  let editProductId = null;
  let existingImages = [];

  // Function to open edit modal (you already have this)
  function updateProduct(id, data){
    editProductId = id;
    document.getElementById("editName").value = data.name;
    document.getElementById("editPrice").value = data.price;
    document.getElementById("editDesc").value = data.description;
    document.getElementById("editCategory").value = data.category;

    existingImages = data.images;
    const editPreview = document.getElementById("editPreview");
    editPreview.innerHTML = "";
    data.images.forEach(url => {
      const img = document.createElement("img");
      img.src = url;
      editPreview.appendChild(img);
    });

    document.getElementById("editModal").style.display = "flex";
    document.getElementById("addProductBox").style.display = "none";
    document.getElementById("productListBox").style.display = "none";
  }

  // ✅ Save changes function
  async function saveProductChanges() {
    if (!editProductId) return alert("No product selected!");

    const docRef = db.collection("products").doc(editProductId);

    try {
      const docSnap = await docRef.get();
      if (!docSnap.exists) {
        alert("This product does not exist anymore!");
        return;
      }

      const updatedData = {
        name: document.getElementById("editName").value,
        price: Number(document.getElementById("editPrice").value),
        description: document.getElementById("editDesc").value,
        category: document.getElementById("editCategory").value,
        images: existingImages
      };

      await docRef.update(updatedData);
      alert("Product updated successfully ");
      document.getElementById("editModal").style.display = "none";
      loadProducts(); // function to reload the product list
    } catch (error) {
      console.error("Error updating product:", error);
      alert("Failed to update product");
    }
  }
</script>
<!-- Add this in your HTML body -->
<div id="popupMessage" style="display:none; position:fixed; bottom:20px; left:50%; transform:translateX(-50%);
  background:#222; color:#fff; padding:15px 25px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.3); z-index:9999;">
  <span id="popupText"></span>
  <button id="popupClose" style="margin-left:15px; background:none; border:none; color:#fff; font-weight:bold; cursor:pointer;">✖</button>
</div>

<script>
function showPopup(message, duration = 3000) {
  const popup = document.getElementById("popupMessage");
  const text = document.getElementById("popupText");
  const closeBtn = document.getElementById("popupClose");

  text.innerText = message;
  popup.style.display = "flex";
  popup.style.alignItems = "center";

  // Close button functionality
  closeBtn.onclick = () => {
    popup.style.display = "none";
  };


  setTimeout(() => {
    popup.style.display = "none";
  }, duration);
}

</script>
<!--
admin access pane -->
<script>
const form = document.getElementById("accessForm").addEventListener("submit", function(e) {
  e.preventDefault(); // prevent form from submitting

  const username = document.getElementById("username").value;
  const password = document.getElementById("password").value;

  // Specify your credentials
  const validUsername = "admin";
  const validPassword = "12345";

  if(username === validUsername && password === validPassword){
    // Credentials correct, hide the form

    document.getElementById("access").style.display = "none";
    showPopup("Access granted!");
    username.value = "";
    password.value= "";


    form.reset(); // optional: show a popup
  } else {
    // Invalid credentials
    window.history.back();
    showPopup("Invalid username or password!");
  }
});



</script>
</body>
</html>
